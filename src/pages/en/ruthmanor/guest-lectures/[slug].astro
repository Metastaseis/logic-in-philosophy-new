---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Prose from "@/components/Prose.astro";
import PhotoGrid from "@/components/PhotoGrid.astro";
import { getCollection } from "astro:content";

const { slug } = Astro.params; // e.g. "2025-01-20-sample-talk"

// Find the EN lecture whose slug ends with this segment
const allEn = await getCollection("ruthLectures", ({ data }) => data.lang === "en");
const entry = allEn.find((e) => e.slug.split("/").pop() === slug);
if (!entry) {
  throw new Error(`Lecture not found for slug: ${slug}`);
}

const data = entry.data;
const { Content } = await entry.render();
---
<BaseLayout title={`${data.title} â€” Ruth Manor`} lang="en" dir="ltr">
  <h1>{data.title}</h1>
  <Prose>
    <p>
      <strong>Date:</strong> <time datetime={data.date}>{data.date}</time><br />
      {data.speakers?.length ? <><strong>Speakers:</strong> {data.speakers.join(", ")}<br /></> : null}
      {data.note ? <><strong>Note:</strong> {data.note}<br /></> : null}
      {data.materials?.length
        ? <>
            <strong>Materials:</strong>
            <ul>
              {data.materials.map((m) => (
                <li><a href={m.url} target="_blank" rel="noopener">{m.label}</a></li>
              ))}
            </ul>
          </>
        : null}
    </p>

    {Content ? <Content /> : null}
  </Prose>

  {data.photos?.length
    ? <>
        <h2 class="mt-10 mb-4 text-xl font-semibold">Photos</h2>
        <PhotoGrid paths={data.photos} />
      </>
    : null}
</BaseLayout>