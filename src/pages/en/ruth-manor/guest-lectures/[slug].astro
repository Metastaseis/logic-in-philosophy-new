---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Prose from "@/components/Prose.astro";
import PhotoGrid from "@/components/PhotoGrid.astro";
import { getCollection } from "astro:content";

/** Build-time: enumerate all lecture pages for EN */
export async function getStaticPaths() {
  const allEn = await getCollection("ruthLectures", ({ data }) => data.lang === "en");
  return allEn.map((entry) => {
    // entry.slug looks like "en/2025-01-20-sample-talk"
    const slug = entry.slug.split("/").pop();
    return {
      params: { slug },       // becomes /en/ruth-manor/guest-lectures/<slug>/
      props: { entry },       // pass the entry to the page
    };
  });
}

// Props from getStaticPaths()
const { entry } = Astro.props;
const data = entry.data;
const { Content } = await entry.render();
---
<BaseLayout title={`${data.title} â€” Ruth Manor`} lang="en" dir="ltr">
  <h1>{data.title}</h1>
  <Prose>
    <p>
      <strong>Date:</strong> <time datetime={data.date}>{data.date}</time><br />
      {data.speakers?.length ? <><strong>Speakers:</strong> {data.speakers.join(", ")}<br /></> : null}
      {data.note ? <><strong>Note:</strong> {data.note}<br /></> : null}
      {data.materials?.length
        ? <>
            <strong>Materials:</strong>
            <ul>
              {data.materials.map((m) => (
                <li><a href={m.url} target="_blank" rel="noopener">{m.label}</a></li>
              ))}
            </ul>
          </>
        : null}
    </p>

    {Content ? <Content /> : null}
  </Prose>

  {data.photos?.length
    ? <>
        <h2 class="mt-10 mb-4 text-xl font-semibold">Photos</h2>
        <PhotoGrid paths={data.photos} />
      </>
    : null}
</BaseLayout>